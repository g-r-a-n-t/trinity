from eth_utils import decode_hex

from eth2.beacon.constants import GWEI_PER_ETH
from eth2.beacon.typing import Gwei, Second, Version
from eth2.configs import Eth2Config

SERENITY_CONFIG = Eth2Config(
    # Misc
    MAX_COMMITTEES_PER_SLOT=2 ** 6,  # (= 64) committees
    TARGET_COMMITTEE_SIZE=2 ** 7,  # (= 128) validators
    MAX_VALIDATORS_PER_COMMITTEE=2 ** 11,  # (= 2,048) validators
    MIN_PER_EPOCH_CHURN_LIMIT=2 ** 2,
    CHURN_LIMIT_QUOTIENT=2 ** 16,
    SHUFFLE_ROUND_COUNT=90,
    HYSTERESIS_QUOTIENT=4,
    HYSTERESIS_DOWNWARD_MULTIPLIER=1,
    HYSTERESIS_UPWARD_MULTIPLIER=5,
    # Genesis
    MIN_GENESIS_ACTIVE_VALIDATOR_COUNT=2 ** 14,
    MIN_GENESIS_TIME=1578009600,  # (= Jan 3, 2020)
    # Gwei values
    MIN_DEPOSIT_AMOUNT=Gwei(2 ** 0 * GWEI_PER_ETH),  # (= 1,000,000,000) Gwei
    MAX_EFFECTIVE_BALANCE=Gwei(2 ** 5 * GWEI_PER_ETH),  # (= 32,000,000,00) Gwei
    EJECTION_BALANCE=Gwei(2 ** 4 * GWEI_PER_ETH),  # (= 16,000,000,000) Gwei
    EFFECTIVE_BALANCE_INCREMENT=Gwei(2 ** 0 * GWEI_PER_ETH),  # (= 1,000,000,000) Gwei
    # Initial values
    GENESIS_FORK_VERSION=Version(b"\x00" * 4),
    BLS_WITHDRAWAL_PREFIX=b"\x00",
    # Time parameters
    GENESIS_DELAY=Second(172800),
    SECONDS_PER_SLOT=Second(12),  # seconds
    MIN_ATTESTATION_INCLUSION_DELAY=2 ** 0,  # (= 1) slots
    SLOTS_PER_EPOCH=2 ** 5,  # (= 32) slots
    MIN_SEED_LOOKAHEAD=2 ** 0,  # (= 1) epochs
    MAX_SEED_LOOKAHEAD=2 ** 2,  # (= 4) epochs
    SLOTS_PER_HISTORICAL_ROOT=2 ** 13,  # (= 8,192) slots
    MIN_VALIDATOR_WITHDRAWABILITY_DELAY=2 ** 8,  # (= 256) epochs
    SHARD_COMMITTEE_PERIOD=2 ** 8,  # (= 256) epochs
    MIN_EPOCHS_TO_INACTIVITY_PENALTY=2 ** 2,
    # State list lengths
    EPOCHS_PER_ETH1_VOTING_PERIOD=32,
    EPOCHS_PER_HISTORICAL_VECTOR=2 ** 16,
    EPOCHS_PER_SLASHINGS_VECTOR=2 ** 13,
    HISTORICAL_ROOTS_LIMIT=2 ** 24,
    VALIDATOR_REGISTRY_LIMIT=2 ** 40,
    # Reward and penalty quotients
    BASE_REWARD_FACTOR=2 ** 6,  # (= 64)
    WHISTLEBLOWER_REWARD_QUOTIENT=2 ** 9,  # (= 512)
    PROPOSER_REWARD_QUOTIENT=2 ** 3,
    INACTIVITY_PENALTY_QUOTIENT=2 ** 24,  # (= 16,777,216)
    MIN_SLASHING_PENALTY_QUOTIENT=2 ** 5,
    # Max operations per block
    MAX_PROPOSER_SLASHINGS=2 ** 4,  # (= 16)
    MAX_ATTESTER_SLASHINGS=2 ** 1,  # (= 2)
    MAX_ATTESTATIONS=2 ** 7,  # (= 128)
    MAX_DEPOSITS=2 ** 4,  # (= 16)
    MAX_VOLUNTARY_EXITS=2 ** 4,  # (= 16)
    # Fork choice
    SAFE_SLOTS_TO_UPDATE_JUSTIFIED=8,
    # Deposit contract
    DEPOSIT_CONTRACT_ADDRESS=decode_hex(
        "0x1234567890123456789012345678901234567890"
    ),  # TBD
)


ALTONA_CONFIG = Eth2Config(
    MAX_COMMITTEES_PER_SLOT=64,
    TARGET_COMMITTEE_SIZE=128,
    MAX_VALIDATORS_PER_COMMITTEE=2048,
    MIN_PER_EPOCH_CHURN_LIMIT=4,
    CHURN_LIMIT_QUOTIENT=65536,
    SHUFFLE_ROUND_COUNT=90,
    MIN_GENESIS_ACTIVE_VALIDATOR_COUNT=640,
    MIN_GENESIS_TIME=1593433800,
    HYSTERESIS_QUOTIENT=4,
    HYSTERESIS_DOWNWARD_MULTIPLIER=1,
    HYSTERESIS_UPWARD_MULTIPLIER=5,
    SAFE_SLOTS_TO_UPDATE_JUSTIFIED=8,
    DEPOSIT_CONTRACT_ADDRESS=decode_hex("0x16e82D77882A663454Ef92806b7DeCa1D394810f"),
    MIN_DEPOSIT_AMOUNT=Gwei(1000000000),
    MAX_EFFECTIVE_BALANCE=Gwei(32000000000),
    EJECTION_BALANCE=Gwei(16000000000),
    EFFECTIVE_BALANCE_INCREMENT=Gwei(1000000000),
    GENESIS_FORK_VERSION=Version(decode_hex("0x00000121")),
    BLS_WITHDRAWAL_PREFIX=decode_hex("0x00"),
    GENESIS_DELAY=Second(172800),
    SECONDS_PER_SLOT=Second(12),
    MIN_ATTESTATION_INCLUSION_DELAY=1,
    SLOTS_PER_EPOCH=32,
    MIN_SEED_LOOKAHEAD=1,
    MAX_SEED_LOOKAHEAD=4,
    EPOCHS_PER_ETH1_VOTING_PERIOD=32,
    SLOTS_PER_HISTORICAL_ROOT=8192,
    MIN_VALIDATOR_WITHDRAWABILITY_DELAY=256,
    SHARD_COMMITTEE_PERIOD=256,
    MIN_EPOCHS_TO_INACTIVITY_PENALTY=4,
    EPOCHS_PER_HISTORICAL_VECTOR=65536,
    EPOCHS_PER_SLASHINGS_VECTOR=8192,
    HISTORICAL_ROOTS_LIMIT=16777216,
    VALIDATOR_REGISTRY_LIMIT=1099511627776,
    BASE_REWARD_FACTOR=64,
    WHISTLEBLOWER_REWARD_QUOTIENT=512,
    PROPOSER_REWARD_QUOTIENT=8,
    INACTIVITY_PENALTY_QUOTIENT=16777216,
    MIN_SLASHING_PENALTY_QUOTIENT=32,
    MAX_PROPOSER_SLASHINGS=16,
    MAX_ATTESTER_SLASHINGS=2,
    MAX_ATTESTATIONS=128,
    MAX_DEPOSITS=16,
    MAX_VOLUNTARY_EXITS=16,
)
